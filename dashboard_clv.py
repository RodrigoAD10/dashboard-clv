# -*- coding: utf-8 -*-
"""dashboard_clv

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1TbuqxT5bn-cUdByEFBm8q8oTuhFTS5pn
"""

import streamlit as st
import pandas as pd

# TÃ­tulo del dashboard
st.set_page_config(layout="wide")
st.title("ğŸ“Š Dashboard - PredicciÃ³n de CLV (Customer Lifetime Value)")

# Cargar datos
@st.cache_data
def load_data():
    return pd.read_csv('predicciones_finales.csv')

df = load_data()

# Sidebar con filtros
st.sidebar.header("ğŸ” Filtros")
age = st.sidebar.slider("Edad (rango normalizado)", float(df["Age"].min()), float(df["Age"].max()), (float(df["Age"].min()), float(df["Age"].max())))
gender = st.sidebar.selectbox("GÃ©nero", options=["Todos", "Hombre", "Mujer"])
discount = st.sidebar.selectbox("Descuento aplicado", options=["Todos", "SÃ­", "No"])
shipping = st.sidebar.selectbox("Tipo de envÃ­o en tienda", options=["Todos", "SÃ­", "No"])

# Filtrar datos
df_filtered = df.copy()
df_filtered = df_filtered[(df_filtered["Age"] >= age[0]) & (df_filtered["Age"] <= age[1])]

if gender != "Todos":
    df_filtered = df_filtered[df_filtered["Gender_Male"] == (gender == "Hombre")]

if discount != "Todos":
    df_filtered = df_filtered[df_filtered["Discount Applied_Yes"] == (discount == "SÃ­")]

if shipping != "Todos":
    df_filtered = df_filtered[df_filtered["Shipping Type_Store Pickup"] == (shipping == "SÃ­")]

# GrÃ¡fico 1: DistribuciÃ³n por CLV_Predicho
st.subheader("ğŸ¯ DistribuciÃ³n de clientes por CLV Predicho")
clv_counts = df_filtered['CLV_Predicho'].value_counts().sort_index()
st.bar_chart(clv_counts)

# GrÃ¡fico 2: Probabilidad promedio de CLV Alto
st.subheader("ğŸ“ˆ Probabilidad promedio de CLV Alto")
st.metric("Probabilidad promedio", f"{df_filtered['Probabilidad_CLV_Alto'].mean():.2f}")

# GrÃ¡fico 3: ComparaciÃ³n CLV_Predicho por gÃ©nero
st.subheader("ğŸ‘¤ DistribuciÃ³n de GÃ©nero segÃºn CLV Predicho")
gender_clv = df_filtered.groupby(['Gender_Male', 'CLV_Predicho']).size().unstack(fill_value=0)
st.bar_chart(gender_clv)

# GrÃ¡fico 4: RelaciÃ³n entre Edad y Probabilidad de CLV Alto
st.subheader("ğŸ“Š RelaciÃ³n entre Edad y Probabilidad de CLV Alto")
st.line_chart(df_filtered[["Age", "Probabilidad_CLV_Alto"]].sort_values("Age").set_index("Age"))